version: '3'
services:
  nodejs:
    build:
      context: .
      dockerfile: Dockerfile-backend
    image: farmacopea/nodejs
    restart: always
    depends_on:
      - mysql
      - apache
    networks:
      - backend
      - frontend
    ports:
      - 30001:30001
    environment:
      APP_PORT: 30001
      MYSQL_HOST: mysql-app
      MYSQL_USER: farmacopea
      MYSQL_PASS: 123
      MYSQL_DB: farmacopeadb
      SMTP_HOST: smtp.gmail.com
      SMTP_PORT: 587
      SMTP_USER:
      SMTP_PASS:
      UPLOADS_FOLDER: /var/www/html
      SECRET_KEY: 4l9uN4114v3s3Er37A
    volumes:
      - ./uploads/:/var/www/html
    container_name: nodejs-app
  reactjs:
    build:
      context: .
      dockerfile: Dockerfile-frontend
    image: farmacopea/reactjs
    depends_on:
      - nodejs
      - apache
    networks:
      - frontend
      - backend
    environment: 
      VIRTUAL_HOST: localhost
      API_URL: nodejs:30001
      UPLOADS_URL: nodejs:9000
    expose:
      - 80
    container_name: reactjs-app
  apache:
    image: php:5.6-apache
    ports:
      - 9000:9000
    networks:
      - frontend 
    container_name: apache-app
    volumes:
      - ./uploads/:/var/www/html
  mysql:
    image: mysql:5.7
    networks:
      - backend
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: farmacopea
      MYSQL_PASSWORD: 123
      MYSQL_DATABASE: farmacopeadb
    volumes:
      - ./database/:/var/lib/mysql
      - ./api-rest/database:/tmp/database
    container_name: mysql-app
networks:
  frontend:
    external:
      name: nginx-proxy
  backend:
